
<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Testing T4 &mdash; T4 Developer Guide</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link href="../_static/jquery-ui.css" rel="stylesheet" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

      <link rel="shortcut icon" href="../_static/favicon.ico" />  
  
  
  <link rel="canonical" href="add the root doc url heret4testing.html" />
  

  
  
  
  <script type="text/javascript" src="../_static/jquery.js"></script>
  <script type="text/javascript" src="../_static/underscore.js"></script>
  <script type="text/javascript" src="../_static/doctools.js"></script>
  <script type="text/javascript" src="../_static/language_data.js"></script>
  <script type="text/javascript" src="../_static/searchtools.js"></script>
  <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
  <script type="text/javascript" src="../_static/js/theme.js"></script>
   
  
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Hello World How Tos" href="helloworld.html" />
    <link rel="prev" title="T4 and Exceptions" href="t4andexceptions.html" /> 
  

	<script>
    $(document).ready(function () {
      $(window).scroll(function () {
        if ($(this).scrollTop() >= 50) {
          $('.fixedbar, .wy-nav-side').addClass('scroll');
          $('.wy-top-menu-wrapper').fadeOut();
        } else {
          $('.fixedbar, .wy-nav-side').removeClass('scroll');
          $('.wy-top-menu-wrapper').fadeIn();
        }
      });
      $(window).scroll(function () {
        if ($(this).scrollTop() > 100) {
          $('#scroll').fadeIn();
        } else {
          $('#scroll').fadeOut();
        }
      });
      $('#scroll').click(function () {
        $("html, body").animate({ scrollTop: 0 }, 600);
        return false;
      });
    });
  </script>

<style>
  .wy-nav-content {max-width:90%}
  </style>
</head>

<body class="wy-body-for-nav">


  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
	  
	  	  
<!-- @@@@@@@@@@@@@@@@ Custom @@@@@@@@@@@@@@@@ -->
        <div class="wy-logo-wrapper">
          <a href="https://www.adobe.com">
            <img src="../_static/acrobaticon.png" class="logo"/>Adobe T4 Documentation</a>
        </div> 
 <!-- @@@@@@@@@@@@@@@@ Custom @@@@@@@@@@@@@@@@ -->
 
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> T4 Developer Guide
          

          
          </a>


          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="writingcppint4.html">C++ Best Practices for T4</a><ul>
<li class="toctree-l2"><a class="reference internal" href="writingcppint4.html#the-most-important-thing">The Most Important Thing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="writingcppint4.html#two-important-questions">Two Important Questions</a></li>
<li class="toctree-l3"><a class="reference internal" href="writingcppint4.html#let-s-not-kid-ourselves">Let’s Not Kid Ourselves</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="writingcppint4.html#typographic-conventions">Typographic Conventions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="writingcppint4.html#identifiers">Identifiers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="writingcppint4.html#case-underbars">Case, Underbars</a></li>
<li class="toctree-l4"><a class="reference internal" href="writingcppint4.html#prefixing-suffixing">Prefixing/Suffixing</a></li>
<li class="toctree-l4"><a class="reference internal" href="writingcppint4.html#macros">Macros</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="writingcppint4.html#tabs">Tabs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="writingcppint4.html#xcode-and-tabs">Xcode and Tabs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="writingcppint4.html#braces-indentation-and-carriage-returns">Braces, Indentation and Carriage Returns</a></li>
<li class="toctree-l3"><a class="reference internal" href="writingcppint4.html#parentheses">Parentheses</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="writingcppint4.html#code-organization">Code Organization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="writingcppint4.html#file-organization">File Organization</a></li>
<li class="toctree-l3"><a class="reference internal" href="writingcppint4.html#writing-a-class">Writing a Class</a><ul>
<li class="toctree-l4"><a class="reference internal" href="writingcppint4.html#also-acceptable-raw-structs">Also Acceptable: Raw Structs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="writingcppint4.html#best-practices">Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="writingcppint4.html#error-handling">Error Handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="writingcppint4.html#resource-acquisition-is-initialization-raii">Resource Acquisition Is Initialization (RAII)</a></li>
<li class="toctree-l3"><a class="reference internal" href="writingcppint4.html#return-values">Return Values</a><ul>
<li class="toctree-l4"><a class="reference internal" href="writingcppint4.html#multiple-return-values">Multiple Return Values</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="writingcppint4.html#inheritance">Inheritance</a><ul>
<li class="toctree-l4"><a class="reference internal" href="writingcppint4.html#the-override-keyword">The override keyword</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="writingcppint4.html#shared-and-unique-pointers">Shared and Unique Pointers</a></li>
<li class="toctree-l3"><a class="reference internal" href="writingcppint4.html#namespaces">Namespaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="writingcppint4.html#integers">Integers</a></li>
<li class="toctree-l3"><a class="reference internal" href="writingcppint4.html#alphabetization">Alphabetization</a></li>
<li class="toctree-l3"><a class="reference internal" href="writingcppint4.html#platform-architecture-and-os-specific-code">Platform, Architecture and OS Specific Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="writingcppint4.html#geometry">Geometry</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="t4fileorganization.html">T4 File Organization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="t4fileorganization.html#about-header-files">About Header Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="t4fileorganization.html#where-everything-goes">Where Everything Goes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="t4fileorganization.html#about-detail-namespaces">About Detail Namespaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="t4fileorganization.html#implementation-headers">Implementation Headers</a></li>
<li class="toctree-l3"><a class="reference internal" href="t4fileorganization.html#how-far-to-go-with-this">How Far to Go With This</a></li>
<li class="toctree-l3"><a class="reference internal" href="t4fileorganization.html#going-even-farther">Going Even Farther</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="t4andexceptions.html">T4 and Exceptions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="t4andexceptions.html#but-let-s-not-kid-ourselves">But Let’s Not Kid Ourselves</a></li>
<li class="toctree-l2"><a class="reference internal" href="t4andexceptions.html#the-gruesome-details">The Gruesome Details</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Testing T4</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#t4-test">t4-test</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#building-t4-test">Building t4-test</a></li>
<li class="toctree-l3"><a class="reference internal" href="#first-steps">First steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#concepts">Concepts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modes-of-execution">Modes of Execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#t4-test-on-ios"><code class="docutils literal notranslate"><span class="pre">t4-test</span></code> on iOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#performance">Performance</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#implementation-details-how-t4-test-measures-performance">Implementation Details: How t4-test Measures Performance</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#output">Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-options">Other Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-t4-test-features">Other t4-test Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#rendering">Rendering</a></li>
<li class="toctree-l4"><a class="reference internal" href="#text-extraction">Text Extraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#document-info">Document Info</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requesting-multiple-pages">Requesting Multiple Pages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#accessibility-info-extraction">Accessibility Info Extraction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tbd">TBD</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cross-engine-comparison">Cross engine comparison</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-pdfium">Building PDFium</a></li>
<li class="toctree-l3"><a class="reference internal" href="#executing-t4-vs-pdfium-tests">Executing t4 vs pdfium tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#t4x">t4x</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#rationale">Rationale</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="helloworld.html">Hello World How Tos</a><ul>
<li class="toctree-l2"><a class="reference internal" href="helloworld.html#t4-projects">T4 Projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="helloworld.html#writing-a-t4-client-in-xcode">Writing a T4 Client in Xcode</a></li>
<li class="toctree-l2"><a class="reference internal" href="helloworld.html#initialization-and-termination">Initialization and Termination</a></li>
<li class="toctree-l2"><a class="reference internal" href="helloworld.html#the-context-lock">The Context Lock</a></li>
<li class="toctree-l2"><a class="reference internal" href="helloworld.html#create-a-document-from-a-file-path">Create a document from a File Path</a></li>
<li class="toctree-l2"><a class="reference internal" href="helloworld.html#traverse-the-store-as-in-the-cos-api">Traverse the Store (as in the COS API)</a></li>
<li class="toctree-l2"><a class="reference internal" href="helloworld.html#extract-text">Extract Text</a></li>
<li class="toctree-l2"><a class="reference internal" href="helloworld.html#get-a-page-s-dimensions-and-rotation">Get a Page’s Dimensions and Rotation</a></li>
<li class="toctree-l2"><a class="reference internal" href="helloworld.html#render-a-page">Render a Page</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cache.html">T4 Cache APIs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cache.html#cache-overview">Cache Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cache.html#example-factorization-cache">Example: Factorization Cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="cache.html#implementing-a-cache">Implementing a Cache</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cache.html#advanced-techniques">Advanced Techniques</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cache.html#caching-runtime-polymorphic-objects">Caching Runtime Polymorphic Objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="cache.html#returning-a-different-key-from-the-requested-one">Returning a Different Key from the Requested One</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cache.html#notes-about-the-cache">Notes about the Cache</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cache.html#thread-safety">Thread Safety</a></li>
<li class="toctree-l3"><a class="reference internal" href="cache.html#const">Const</a></li>
<li class="toctree-l3"><a class="reference internal" href="cache.html#purging">Purging</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cache.html#other-interesting-cache-features">Other Interesting Cache Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cache.html#memory-thresholds">Memory Thresholds</a></li>
<li class="toctree-l3"><a class="reference internal" href="cache.html#computing-cached-object-sizes">Computing Cached Object Sizes</a></li>
<li class="toctree-l3"><a class="reference internal" href="cache.html#update-your-object-s-size">Update Your Object’s Size</a></li>
<li class="toctree-l3"><a class="reference internal" href="cache.html#resource-pools">Resource Pools</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="draw.html">Drawing PDF with T4</a><ul>
<li class="toctree-l2"><a class="reference internal" href="draw.html#using-display-event-stream">Using <code class="docutils literal notranslate"><span class="pre">display_event_stream</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data_store.html">Data Store</a><ul>
<li class="toctree-l2"><a class="reference internal" href="data_store.html#data-block">data_block</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_store.html#id1">data_store</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_store.html#data-block-stream">data_block_stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_store.html#comparison-data-store-and-data-block-stream">Comparison: data_store and data_block_stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_store.html#creating-data-stores">Creating data_stores</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_store.html#creating-your-own-data-store">Creating Your Own data_store</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_store.html#creating-your-own-data-block-stream">Creating Your Own data_block_stream</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="int_union.html">Using int_union</a><ul>
<li class="toctree-l2"><a class="reference internal" href="int_union.html#xprogrammers-xset-theorists">∀x∈Programmers:x∈Set Theorists</a><ul>
<li class="toctree-l3"><a class="reference internal" href="int_union.html#the-int-union-template">The int_union Template</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="int_union.html#assignment-and-comparison">Assignment and Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="int_union.html#integral-math">Integral Math</a></li>
<li class="toctree-l2"><a class="reference internal" href="int_union.html#integral-conversion">Integral Conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="int_union.html#performance-and-safety-considerations">Performance and Safety Considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="int_union.html#correctness-implications-and-implementation-limits">Correctness Implications and Implementation Limits</a><ul>
<li class="toctree-l3"><a class="reference internal" href="int_union.html#the-special-template-parameters">The “Special” Template Parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="memory.html">T4 Memory APIs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="memory.html#a-quick-tour-of-t4-memory-facilities">A Quick Tour of T4 Memory Facilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="memory.html#memory-and-the-t4-cache">Memory and the T4 Cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="memory.html#simple-allocation">Simple Allocation</a></li>
<li class="toctree-l3"><a class="reference internal" href="memory.html#smart-pointers-and-containers">Smart Pointers and Containers</a></li>
<li class="toctree-l3"><a class="reference internal" href="memory.html#make-unique">make_unique</a></li>
<li class="toctree-l3"><a class="reference internal" href="memory.html#shared-ptr">shared_ptr</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="memory.html#memory-usage">Memory Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory.html#managing-memory-consumption">Managing Memory Consumption</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pagetree.html">Page Tree Navigation in T4</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pagetree.html#choosing-the-right-type">Choosing the Right Type</a></li>
<li class="toctree-l2"><a class="reference internal" href="pagetree.html#getting-from-one-type-to-another">Getting from One Type to Another</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="params.html">T4 Params Module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="params.html#problem-statement">Problem Statement</a></li>
<li class="toctree-l2"><a class="reference internal" href="params.html#approaches-to-solving-this-problem">Approaches to Solving this Problem</a><ul>
<li class="toctree-l3"><a class="reference internal" href="params.html#parameter-structs">Parameter Structs</a></li>
<li class="toctree-l3"><a class="reference internal" href="params.html#parameter-dictionaries">Parameter Dictionaries</a></li>
<li class="toctree-l3"><a class="reference internal" href="params.html#parameter-soup">Parameter Soup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="params.html#using-t4-params">Using T4 Params</a><ul>
<li class="toctree-l3"><a class="reference internal" href="params.html#exposing-a-t4-params-based-api">Exposing a T4 Params-Based API</a></li>
<li class="toctree-l3"><a class="reference internal" href="params.html#extracting-parameters-from-a-parameters-dictionary">Extracting Parameters from a Parameters Dictionary</a></li>
<li class="toctree-l3"><a class="reference internal" href="params.html#invoking-a-t4-params-based-api">Invoking a T4 Params-Based API</a></li>
<li class="toctree-l3"><a class="reference internal" href="params.html#evolving-a-t4-params-based-api">Evolving a T4 Params-Based API</a></li>
<li class="toctree-l3"><a class="reference internal" href="params.html#compile-time-errors">Compile-Time Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="params.html#recommended-hybrid-approach">Recommended: Hybrid Approach</a></li>
<li class="toctree-l3"><a class="reference internal" href="params.html#about-parameter-values">About Parameter Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="params.html#required-value-parameters">Required Value Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="params.html#required-reference-parameters">Required Reference Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="params.html#optional-parameters">Optional Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="params.html#required-parameters-with-default-values">Required Parameters with Default Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="params.html#parameter-descriptions-and-constexpr">Parameter Descriptions and constexpr</a></li>
<li class="toctree-l3"><a class="reference internal" href="params.html#abi-issues">ABI Issues</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tile_cache.html">Tile Cache</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tile_cache.html#the-basics">The Basics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tile_cache.html#creating-a-pdf-tile-cache">Creating a pdf_tile_cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="tile_cache.html#controlling-a-pdf-tile-cache">Controlling a pdf_tile_cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="tile_cache.html#displaying-a-pdf-tile-cache-s-contents">Displaying a pdf_tile_cache’s Contents</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tile_cache.html#pdf-tile-cache-details">pdf_tile_cache Details</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tile_cache.html#tile-cache-requesters">Tile Cache Requesters</a></li>
<li class="toctree-l3"><a class="reference internal" href="tile_cache.html#bitmaps">Bitmaps</a></li>
<li class="toctree-l3"><a class="reference internal" href="tile_cache.html#defining-the-bitmap-type">Defining the Bitmap Type</a></li>
<li class="toctree-l3"><a class="reference internal" href="tile_cache.html#drawing-parameters">Drawing Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="tile_cache.html#tile-collections">Tile Collections</a></li>
<li class="toctree-l3"><a class="reference internal" href="tile_cache.html#pdf-tile-cache-implementation-and-theory">pdf_tile_cache Implementation and Theory</a></li>
<li class="toctree-l3"><a class="reference internal" href="tile_cache.html#pdf-tile-cache-state">pdf_tile_cache State</a></li>
<li class="toctree-l3"><a class="reference internal" href="tile_cache.html#about-painting-progress">About Painting Progress</a></li>
<li class="toctree-l3"><a class="reference internal" href="tile_cache.html#pile-tiles-implementation">pile_tiles Implementation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="transient_heap.html">Transient Heap</a><ul>
<li class="toctree-l2"><a class="reference internal" href="transient_heap.html#quick-start">Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="transient_heap.html#transient-heap-applications">transient_heap Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="transient_heap.html#grow-only-or-immutable-graphs-of-heterogeneous-objects">Grow-Only or Immutable Graphs of Heterogeneous Objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="transient_heap.html#algorithm-lifetime-bound-transient-allocations">Algorithm-Lifetime Bound Transient Allocations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="transient_heap.html#destruction-of-objects-in-a-transient-heap">Destruction of Objects in a transient_heap</a></li>
<li class="toctree-l2"><a class="reference internal" href="transient_heap.html#snapshots">Snapshots</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="typed_bool.html">Typed Bool</a><ul>
<li class="toctree-l2"><a class="reference internal" href="typed_bool.html#existing-approaches">Existing Approaches</a><ul>
<li class="toctree-l3"><a class="reference internal" href="typed_bool.html#t4-typed-bool">t4::typed_bool</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

        <!--- @@@@@@@@@@@@@@@@ Custom @@@@@@@@@@@@@@@@ -->
        <div class="fixedbar">  
          <div class="wy-menu-items">
            
            <a href="../gettingstarted/index.html" class="topbarlink">Getting Started</a>  
            <a href="../developerguide/index.html" class="topbarlink">Developer Guide</a>  

          
          </div>  <!--
          <div class="sign-in">
            <a href="" class="btn btn-console">Jira or?</a>
            <a href="https://auth.services.adobe.com/en_US/index.html">Sign in?</a>
          </div>-->
        </div>
        <!--- @@@@@@@@@@@@@@@@ Custom @@@@@@@@@@@@@@@@ -->
   
      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">T4 Developer Guide</a>
        
      </nav>


      <div class="wy-nav-content">
      <a href="#" id="scroll" style="display:inline;"><span></span></a>
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Testing T4</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="helloworld.html" class="btn btn-neutral float-right" title="Hello World How Tos" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      
      
        <a href="t4andexceptions.html" class="btn btn-neutral float-left" title="T4 and Exceptions" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="testing-t4">
<h1>Testing T4<a class="headerlink" href="#testing-t4" title="Permalink to this headline">¶</a></h1>
<div class="section" id="t4-test">
<h2>t4-test<a class="headerlink" href="#t4-test" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">t4-test</span></code> is a command-line utility which is used to generate, validate
and exercise rendering, reflow and text extraction in T4. You can also
use it to produce <a class="reference external" href="https://wiki.corp.adobe.com/display/t4/T4+vs+PDFium">renderings</a>
and extract text from a pdf.</p>
<div class="section" id="building-t4-test">
<h3>Building t4-test<a class="headerlink" href="#building-t4-test" title="Permalink to this headline">¶</a></h3>
<p>Open the t4_all workspace:</p>
<p><code class="docutils literal notranslate"><span class="pre">t4/projects/all/xcode/t4_all.xcworkspace</span></code></p>
<p>Select the <code class="docutils literal notranslate"><span class="pre">t4-test.osx.Debug</span></code> or the <code class="docutils literal notranslate"><span class="pre">t4-test.osx.Release</span></code> scheme (My Mac
target). This will build the <code class="docutils literal notranslate"><span class="pre">t4-test</span></code> command-line tool. If you choose
debug, it will run very, very slowly but you’ll drop into the debugger
on assertion failures, which is frequently interesting. If you choose
release, it will run much faster but assertions won’t be checked. In
practice I’ve found running release build is usually the way to go.</p>
</div>
<div class="section" id="first-steps">
<h3>First steps<a class="headerlink" href="#first-steps" title="Permalink to this headline">¶</a></h3>
<p>If you’re running inside of Xcode, you can choose Product&gt;Scheme&gt;Edit
Scheme…&gt;Run&gt;Argument, and enter or toggle arguments in that panel.
Choosing Debug&gt;Run/Test/Profile will then fire off t4-test using those
arguments. You can specify the working directory in the “Options” tab.</p>
<p>Otherwise you’ll need to run t4-test directly from the command line,
using the full path to the build location visible in the Xcode build
log.</p>
<p>Generate a baseline from <a class="reference external" href="https://dcm-mac-003.corp.adobe.com/download/com.adobe.t4_batch/">this collection of
pdfs</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">generate</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">dcm</span><span class="o">-</span><span class="n">mac</span><span class="o">-</span><span class="mf">003.</span><span class="n">corp</span><span class="o">.</span><span class="n">adobe</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">download</span><span class="o">/</span><span class="n">com</span><span class="o">.</span><span class="n">adobe</span><span class="o">.</span><span class="n">t4_batch</span><span class="o">/</span><span class="n">Sanity</span><span class="o">/</span><span class="n">PDFs</span><span class="o">/</span><span class="mf">1.0</span><span class="o">/</span> <span class="o">--</span><span class="n">out</span><span class="o">=./</span><span class="n">demo_test</span>
</pre></div>
</div>
<p>This creates a directory in the current working directory named
“demo_test.” Copy it up to the server adjacent to the <code class="docutils literal notranslate"><span class="pre">demo_pdfs</span></code>
directory noted above, and execute the baseline:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">execute</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">the</span><span class="o">/</span><span class="n">baselines</span><span class="o">/</span><span class="n">demo_test</span> <span class="o">--</span><span class="n">out</span><span class="o">=./</span><span class="n">demo_out</span>
</pre></div>
</div>
<p>This executes all the tests generated in the first step and verifies
that the results match. If any differences occur, errors are reported
in <code class="docutils literal notranslate"><span class="pre">./demo_out</span></code>. For example, if a page rendering changes, the new version
is written to <code class="docutils literal notranslate"><span class="pre">./demo_out</span></code> and a descriptive error message appears in the
console.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--out</span></code> parameter is optional. If you do not provide it t4-test will
generate its HTML output in a temporary folder and open the
root <code class="docutils literal notranslate"><span class="pre">index.html</span></code> file on test completion.</p>
<p>If you don’t have a baseline, but you just want to point t4 at a bunch
of pdfs and exercise it randomly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">exercise</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">dcm</span><span class="o">-</span><span class="n">mac</span><span class="o">-</span><span class="mf">003.</span><span class="n">corp</span><span class="o">.</span><span class="n">adobe</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">download</span><span class="o">/</span><span class="n">com</span><span class="o">.</span><span class="n">adobe</span><span class="o">.</span><span class="n">t4_batch</span><span class="o">/</span><span class="n">Sanity</span><span class="o">/</span><span class="n">PDFs</span><span class="o">/</span><span class="mf">1.0</span><span class="o">/</span>
</pre></div>
</div>
<p>This will create and execute a bunch of tests, but since there’s no test
description to start with, there are no results to compare. Really all
this does is see if your code crashes or asserts when given a giant pile
of .pdfs.</p>
</div>
<div class="section" id="concepts">
<h3>Concepts<a class="headerlink" href="#concepts" title="Permalink to this headline">¶</a></h3>
<p><strong>Test</strong>: a single test. Currently there are only two supported kinds of
tests:</p>
<ol class="arabic simple">
<li><p>Page rendering. Parametrized by page number, page-to-device
transform, device clip, and optional reflow key.</p></li>
<li><p>Text extraction. Parametrized by page number, extracts all the text
on that page in UTF8.</p></li>
</ol>
<p>A single test corresponds to a <code class="docutils literal notranslate"><span class="pre">&lt;test&gt;</span></code> node in the .xml file for a
document test (see below).</p>
<p><strong>Document Test</strong>: A set of tests to be executed on a single .pdf
document. A document test is comprised of a single .xml file and a
collection of .png and .txt files that contain the results of the tests
described in the .xml file.</p>
<p><strong>Baseline:</strong> a hierarchical collection of document tests (.xml and
other supporting files) on a web server, which completely describe a set
of tests on a potentially large collection of pdf files and their
expected results. Baselines are generated by <code class="docutils literal notranslate"><span class="pre">t4-test</span></code> based on a
collection of .pdf files.</p>
<p>You can browse an example
baseline <a class="reference external" href="https://sj2swu915.corp.adobe.com/Documents/gdow/demo/demo_test/">here</a>.
The collection of test files used to produce that baseline is
<a class="reference external" href="https://sj2swu915.corp.adobe.com/Documents/gdow/demo/demo_pdfs/">here</a>.
You can see that the hierarchies are very similar. The command used to
produce that baseline was:</p>
</div>
<div class="section" id="modes-of-execution">
<h3>Modes of Execution<a class="headerlink" href="#modes-of-execution" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">t4-test</span></code> executes in one of three modes:</p>
<p>In <strong>Test Generation</strong> mode, t4-test is given a pointer to a root URL or
file path of a hierarchy of .pdf files. It searches the hierarchy rooted
at that location for PDF files, and produces a document test for each
one. The resulting baseline is stored on the local file system.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Use</span> <span class="n">the</span> <span class="n">files</span> <span class="n">at</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">URL</span> <span class="n">to</span> <span class="n">produce</span> <span class="n">a</span> <span class="n">complete</span> <span class="n">baseline</span> <span class="n">at</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">local</span> <span class="n">path</span>
<span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">generate</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">pdf_dir</span><span class="o">/</span> <span class="o">--</span><span class="n">out</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">generated</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="nb">dir</span><span class="o">/</span>
</pre></div>
</div>
<p>In <strong>Test Execution</strong> mode, t4-test is given a pointer to the root URL
or file path of a baseline. It searches the hierarchy for .xml files,
which it presumes describe document tests and their baseline results.
t4-test executes each test and verifies that its results match (or
deviate acceptably from) the baseline results.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Run</span> <span class="n">the</span> <span class="n">baseline</span> <span class="n">at</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">URL</span><span class="o">.</span> <span class="n">Results</span> <span class="n">that</span> <span class="n">differ</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">baseline</span> <span class="n">are</span> <span class="n">written</span> <span class="n">to</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">local</span> <span class="n">path</span> <span class="p">(</span><span class="k">if</span> <span class="n">present</span><span class="p">)</span>
<span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">execute</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">baseline</span><span class="o">/</span> <span class="o">--</span><span class="n">out</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">results</span><span class="o">/</span><span class="nb">dir</span><span class="o">/</span>
</pre></div>
</div>
<p>In <strong>Non-baselined Test Execution</strong> mode, t4-test is given a pointer to
a root URL or file path of a hierarchy of .pdf files, just like in Test
Generation mode. As in test generation, it searches the hierarchy for
.pdfs, and produces a test for each one. Rather than storing the test,
though, it simply executes it without comparing it to any baseline. This
is useful if you just want to exercise a bunch of code and make sure
nothing crashes or asserts.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Generate</span> <span class="ow">and</span> <span class="n">run</span> <span class="n">random</span> <span class="n">tests</span> <span class="n">based</span> <span class="n">on</span> <span class="n">the</span> <span class="n">pdf</span> <span class="n">files</span> <span class="n">at</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">URL</span><span class="o">/</span><span class="n">path</span><span class="o">.</span> <span class="n">There</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">baseline</span> <span class="n">to</span> <span class="n">compare</span> <span class="n">to</span><span class="p">,</span>
<span class="o">//</span> <span class="n">so</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">just</span> <span class="n">good</span> <span class="k">for</span> <span class="n">exercising</span> <span class="n">the</span> <span class="n">code</span><span class="o">.</span>
<span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">exercise</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">pdf_dir</span><span class="o">/</span>
</pre></div>
</div>
</div>
<div class="section" id="t4-test-on-ios">
<h3><code class="docutils literal notranslate"><span class="pre">t4-test</span></code> on iOS<a class="headerlink" href="#t4-test-on-ios" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">t4-test</span></code> runs on iOS as well as OSX. The <code class="docutils literal notranslate"><span class="pre">--out</span></code> parameter should be a
relative path, and it will be evaluated relative to
the <code class="docutils literal notranslate"><span class="pre">t4-test</span></code> application’s Documents directory. Typically on the device
you’ll run with a command line like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">generate</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">my_pdfs</span> <span class="o">--</span><span class="n">out</span><span class="o">=</span><span class="n">my_smoke_test</span>
</pre></div>
</div>
<p>After the test generation completes, you can open iTunes and you’ll see
a “my_smoke_test” directory in t4-test’s documents folder. Copy this to
a server location, and you can then use it as a baseline for later runs.</p>
</div>
<div class="section" id="performance">
<h3>Performance<a class="headerlink" href="#performance" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">t4-test</span></code> can be used to generate performance tests using
the <code class="docutils literal notranslate"><span class="pre">--performance</span></code> command-line switch, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">generate</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">dcm</span><span class="o">-</span><span class="n">mac</span><span class="o">-</span><span class="mf">003.</span><span class="n">corp</span><span class="o">.</span><span class="n">adobe</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">download</span><span class="o">/</span><span class="n">com</span><span class="o">.</span><span class="n">adobe</span><span class="o">.</span><span class="n">t4_batch</span><span class="o">/</span><span class="n">Sanity</span><span class="o">/</span><span class="n">PDFs</span><span class="o">/</span><span class="mf">1.0</span><span class="o">/</span> <span class="o">--</span><span class="n">out</span> <span class="n">perf_test</span> <span class="o">--</span><span class="n">performance</span>
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">--performance</span></code> switch is used, the generated test will measure how
long the various tests take, and include those measurements in the
baseline.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Performance tests are expensive to generate! There is a lot of variation
run to run, and the process clock is very low-frequency, so tests have
to be run many, many times to produce usefully precise results.
Performance tests are also expensive to execute, for the same reason.</p>
</div>
<p>Despite all this repetition, performance tests will still sometimes
spuriously fail. There’s not much I can do about this. See the
“Implementation Details” section below.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--no_performance</span></code> flag can be used in test execution mode to skip all
performance tests in a baseline. You can use this if you’re only
concerned about correctness and you don’t want to waste tons of cycles
running every test several times, as needed to perform a performance
test.</p>
<p>During test execution, t4-test will make repeated attempts to pass a
performance test, in the off chance that an attempt was affected by some
spurious background task. The <code class="docutils literal notranslate"><span class="pre">--max-performance-test-attempts</span></code> switch can
be used to control the number of attempts the system will make to pass a
performance test. By default it is 5. I’ve found that if you’re running
t4-test under instruments (a very useful exercise sometimes), setting
this switch to 1 is a good way to generate apples-to-apples comparisons
of profiles produced by separate builds.</p>
<div class="section" id="implementation-details-how-t4-test-measures-performance">
<h4>Implementation Details: How t4-test Measures Performance<a class="headerlink" href="#implementation-details-how-t4-test-measures-performance" title="Permalink to this headline">¶</a></h4>
<div class="section" id="iteration-counts">
<h5>Iteration Counts<a class="headerlink" href="#iteration-counts" title="Permalink to this headline">¶</a></h5>
<p>Measuring performance is tricky and <code class="docutils literal notranslate"><span class="pre">t4-test</span></code> plays a lot of games to
produce reliable results, even with wide error bars. Some tests, such as
text extraction from a simple page, run so incredibly quickly that they
don’t even consume a single cycle of the process clock (which has a low
frequency, 10 ms on the device). To solve this problem we include with
each test an “iterations” count.</p>
<p>All tests are implemented by a simple lambda functor provided to the
t4-test test code. In test generation, we execute this lambda over and
over until at least 1000 msec have been consumed. The number of
executions we wind up needing to exceed this threshold is stored in the
test’s “iterations” elements. Then, at test execution time, we execute
the same test that same number of times and compare the accumulated
time. This means that tests that are trivially fast in
non-performance-testing mode will still consume at least a second in
performance-testing mode. This practice is why failed tests will
frequently report “expected result near 1000 msec,” or some number only
slightly larger than 1000.</p>
</div>
<div class="section" id="primed-vs-unprimed-execution">
<h5>“Primed” vs. “Unprimed” Execution<a class="headerlink" href="#primed-vs-unprimed-execution" title="Permalink to this headline">¶</a></h5>
<p>The execution of an algorithm with the same inputs can vary greatly
depending on the state of the <a class="reference external" href="./cache.html">t4
cache</a>. To get consistent
results on a test’s execution we need to be able to start the cache in a
consistent state. As far as t4-test is concerned there are really only
two states that we can consistently reproduce: “primed” and “unprimed.”
We execute an algorithm in the “unprimed” state by completely purging
the cache before executing it. We execute an algorithm in the “primed”
state by executing it <em>immediately</em> after a separate, complete execution
(whose timing and results we ignore).</p>
<p>These are both valuable and interesting things to measure! “Unprimed”
execution is relevant to the amount of time it takes to open a document
“from scratch.” “Primed” execution is relevant to operations that tend
to use the results of operations that are likely to benefit from the
cache, such as text rendering and display list traversal.</p>
<p>For any given test, we perform both primed and unprimed executions of
the test. These two different flavors of execution will produce
different timings, likely with different iteration counts. When these
tests fail, you’ll see output like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Performance</span> <span class="n">failed</span> <span class="p">(</span><span class="n">unprimed</span><span class="p">)</span> <span class="ow">in</span> <span class="o">/</span><span class="n">bugs</span><span class="o">/</span><span class="n">arterials8</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mf">03.</span><span class="n">xml</span><span class="p">,</span> <span class="n">test</span> <span class="nb">id</span> <span class="o">=</span> <span class="mi">5</span> <span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="n">page</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">expected</span> <span class="n">result</span> <span class="n">near</span> <span class="mi">22350</span> <span class="n">msec</span>
        <span class="n">got</span> <span class="mi">27056</span> <span class="n">msec</span><span class="p">,</span> <span class="p">(</span><span class="mf">21.06</span><span class="o">%</span> <span class="n">slower</span><span class="p">)</span>
<span class="n">Performance</span> <span class="n">failed</span> <span class="p">(</span><span class="n">primed</span><span class="p">)</span> <span class="ow">in</span> <span class="o">/</span><span class="n">bugs</span><span class="o">/</span><span class="n">arterials8</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mf">03.</span><span class="n">xml</span><span class="p">,</span> <span class="n">test</span> <span class="nb">id</span> <span class="o">=</span> <span class="mi">5</span> <span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="n">page</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">expected</span> <span class="n">result</span> <span class="n">near</span> <span class="mi">11530</span> <span class="n">msec</span>
        <span class="n">got</span> <span class="mi">13964</span> <span class="n">msec</span><span class="p">,</span> <span class="p">(</span><span class="mf">21.11</span><span class="o">%</span> <span class="n">slower</span><span class="p">)</span>
</pre></div>
</div>
<p>This result means that test id 5 was 21.06% slower unprimed, and 21.11%
slower primed. In this example both tests failed. Depending on the
reason for the degradation, you might see the primed test fail but not
the unprimed, or vice versa.</p>
</div>
</div>
</div>
<div class="section" id="output">
<h3>Output<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h3>
<p>In <strong>Test Execution</strong> and <strong>Non-baselined Test Execution</strong> mode, t4-test
outputs results to the Xcode target output or shell when run from those
respective environments. In addition it writes a set of files to the
directory specified by <code class="docutils literal notranslate"><span class="pre">--out</span></code> (or a location in the temp directory if no
<code class="docutils literal notranslate"><span class="pre">--out</span></code> argument is provided). The layout and content of these files is
described in <a class="reference external" href="https://wiki.corp.adobe.com/display/t4/t4_test+Output">t4-test Output</a>.</p>
</div>
<div class="section" id="other-options">
<h3>Other Options<a class="headerlink" href="#other-options" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 44%" />
<col style="width: 56%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Switch</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--zap</span></code></p></td>
<td><p>Completely erase the directory specified by the
<code class="docutils literal notranslate"><span class="pre">--out</span></code> parameter before generating/executing the
test. (generate, execute, compare)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--verbose</span></code></p></td>
<td><p>Pipe a lot of detailed output to stdout describing
the progress of the test generation/execution. (all)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--interruptions</span></code></p></td>
<td><p>Exercises test interruption; injects random
exceptions into tests to verify that the code
correctly handles these events. There is no “output”
for an interruptions test; the test is deemed
successful if it doesn’t crash. (execute, exercise)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--branch</span> <span class="pre">&lt;&lt;branch</span> <span class="pre">name&gt;&gt;</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">--commit</span> <span class="pre">&lt;&lt;commit</span> <span class="pre">hash&gt;&gt;</span></code></p>
</td>
<td><p>When generating a test, tag the test with the
specified branch and commit hash to allow a
developer to recreate the build that produced the
test later. (generate)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--id</span> <span class="pre">&lt;&lt;test</span> <span class="pre">id&gt;&gt;</span></code></p></td>
<td><p>Perform only the test with the specified ID; skip
all the others. Useful in debugging. (execute)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--max-performance-test-attempts</span> <span class="pre">&lt;&lt;n&gt;&gt;</span></code></p></td>
<td><p>When generating or executing performance tests, make
n attempts and take the fastest result. Defaults to
5. (generate, execute)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--no-performance</span></code></p></td>
<td><p>When executing tests, skip performance testing even
if the baseline has performance data. (execute)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--diff-tolerance</span> <span class="pre">&lt;&lt;n&gt;&gt;</span></code></p></td>
<td><p>Specify the amount of rendering difference tolerated
(0 = perfect match (default), 1 = small color value
differences tolerated, 2 = anything goes) (execute)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--simple</span></code></p></td>
<td><p>When generating, produce at most one full-page,
non-reflowed rendering per page in the document. Do
not generate reflow, random or text extraction
tests.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--page-subset</span></code></p></td>
<td><p>Constrain the total number of tests that are
produced. E.g.: If user says <code class="docutils literal notranslate"><span class="pre">--page-subset=10</span></code>
and there are 99 pages in document , it will
generate baselines for page #:
0,10,20,30,40,50,60,70,80,90</p>
<p>If user specifies more than pages present in pdf
file (say 200), it will create baselines for all the
pages(99).</p>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--page-subset-random</span></code></p></td>
<td><p>Constrain the total number of tests that are
produced on subset of random pages. For example: if
user says <code class="docutils literal notranslate"><span class="pre">--page-subset-random=10</span></code> and there are
99 pages in document , it will choose 10 pages
randomly to create baselines from.</p>
<p>If user specifies more than pages present in pdf
file(say 200), it will create baselines for all the
pages (99).</p>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--relative-urls</span></code></p></td>
<td><p>In <strong>generate</strong> mode, document URLs (the links to
the .pdf file being tested) are generated relative
to the location of the baseline test file (the
.xml).</p>
<p>In <strong>execute</strong> mode, URLs in the generated report
that reference resources in the baseline are
relative instead of absolute.</p>
<p>These options are useful in environments like iOS
where the full path to the documents directory can
change at surprising times as a security measure.
Unfortunately it means that you can’t use a baseline
or a report if you move it to a new location in the
file system (unless you move the referred-to
resources at the same time).</p>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--highlights</span></code></p></td>
<td><p>Generate “highlight” tests which produce images of
text bboxes instead of page renderings. (generate)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--random-test-count</span> <span class="pre">&lt;&lt;n&gt;&gt;</span></code></p></td>
<td><p>For each page of each document, generate &lt;&lt;n&gt;&gt;
random rendering tests (using randomly generated
clip bounds, transform and reflow keys). The draw
parameters are random, but chosen such that they
represent useful subsets of page content. Default
value: 5. (generate, exercise)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="other-t4-test-features">
<h3>Other t4-test Features<a class="headerlink" href="#other-t4-test-features" title="Permalink to this headline">¶</a></h3>
<p>t4-test is also useful for just rendering and querying PDF files.</p>
<div class="section" id="rendering">
<h4>Rendering<a class="headerlink" href="#rendering" title="Permalink to this headline">¶</a></h4>
<p>Render the first page of a local .pdf file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">draw</span> <span class="n">kingtut</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
<p>This will render the first page of a .pdf file at 100%, output the
results to a .png in the temp folder, and (on OSX) open that .png in
Preview. On iOS it will display the produced .png in a scrolling view.</p>
<p>Render the second page of a PDF at a specified URL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">draw</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">sj2swu915</span><span class="o">.</span><span class="n">corp</span><span class="o">.</span><span class="n">adobe</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Documents</span><span class="o">/</span><span class="n">gdow</span><span class="o">/</span><span class="n">smoke_pdfs</span><span class="o">/</span><span class="n">bezier</span><span class="o">/</span><span class="n">kingtut</span><span class="o">.</span><span class="n">pdf</span> <span class="o">--</span><span class="n">page</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Remember that page numbering is 0-based.</p>
<p>Render with a specific clip and scale:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">draw</span> <span class="n">kingtut</span><span class="o">.</span><span class="n">pdf</span> <span class="o">--</span><span class="n">scale</span> <span class="mi">2</span> <span class="o">--</span><span class="n">clip</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">200</span> <span class="mi">200</span>
</pre></div>
</div>
<p>Renders the first page through a flip matrix at a scale of 2, but only
the top left 200 x 200 pixels. The clip parameter is always in device
space, so parameters should be integers.</p>
<p>Render through an arbitrary matrix:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">draw</span> <span class="n">kingtut</span><span class="o">.</span><span class="n">pdf</span> <span class="o">--</span><span class="n">matrix</span> <span class="o">.</span><span class="mi">707</span> <span class="o">.</span><span class="mi">707</span> <span class="o">-.</span><span class="mi">707</span> <span class="o">.</span><span class="mi">707</span> <span class="mi">0</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Renders the first page at an approximately 45 degree angle.</p>
<p>Render with reflow:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">draw</span> <span class="n">alice</span><span class="o">.</span><span class="n">pdf</span> <span class="o">--</span><span class="n">reflow</span>
</pre></div>
</div>
<p>Renders the first page of <code class="docutils literal notranslate"><span class="pre">alice.pdf</span></code> in a reflowed view. Default
parameters are chosen for all reflow parameters. You can specify reflow
parameters explicitly if you prefer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">draw</span> <span class="n">alice</span><span class="o">.</span><span class="n">pdf</span> <span class="o">--</span><span class="n">reflow</span> <span class="mi">500</span> <span class="mi">90</span> <span class="mi">270</span> <span class="mi">300</span> <span class="mi">5</span>
</pre></div>
</div>
<p>The reflow parameters are width, screen rotation, base page rotation,
subpage height, and subpage phase. All parameters are optional; the two
rotation values must be multiples of 90 degrees. The default value for
width is 500.</p>
<div class="section" id="rendering-highlights">
<h5>Rendering Highlights<a class="headerlink" href="#rendering-highlights" title="Permalink to this headline">¶</a></h5>
<p>Render the page, and highlight all the text:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">draw</span> <span class="n">alice</span><span class="o">.</span><span class="n">pdf</span> <span class="o">--</span><span class="n">highlight</span><span class="o">-</span><span class="n">start</span> <span class="n">page</span><span class="o">-</span><span class="n">start</span> <span class="o">--</span><span class="n">highlight</span><span class="o">-</span><span class="n">end</span> <span class="n">page</span><span class="o">-</span><span class="n">end</span>
</pre></div>
</div>
<p>Render the page with a specified highlight range (these are the
<code class="docutils literal notranslate"><span class="pre">m_dlEntryNum</span></code>, <code class="docutils literal notranslate"><span class="pre">m_stringNum</span></code>, <code class="docutils literal notranslate"><span class="pre">m_glyphNum</span></code> and <code class="docutils literal notranslate"><span class="pre">m_unicodeNum</span></code> fields of
the <code class="docutils literal notranslate"><span class="pre">content_point</span></code> data structure):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">draw</span> <span class="n">alice</span><span class="o">.</span><span class="n">pdf</span> <span class="o">--</span><span class="n">highlight</span><span class="o">-</span><span class="n">start</span> <span class="mi">2</span> <span class="mi">5</span> <span class="mi">12</span> <span class="mi">4</span> <span class="n">true</span> <span class="o">--</span><span class="n">highlight</span><span class="o">-</span><span class="n">end</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">9</span> <span class="mi">2</span> <span class="n">false</span>
</pre></div>
</div>
</div>
<div class="section" id="rendering-dynamic-view">
<h5>Rendering Dynamic View<a class="headerlink" href="#rendering-dynamic-view" title="Permalink to this headline">¶</a></h5>
<p>Render the PDF in dynamic view:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">dv</span> <span class="n">alice</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
<p>This will create a directory of HTML representing the dynamic view, and
open it in the local browser.</p>
</div>
</div>
<div class="section" id="text-extraction">
<h4>Text Extraction<a class="headerlink" href="#text-extraction" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">text</span> <span class="n">alice</span><span class="o">.</span><span class="n">pdf</span> <span class="o">--</span><span class="n">page</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Extracts all the text on the first page of alice.pdf and writes it to
the console.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">text</span> <span class="n">hello_world</span><span class="o">.</span><span class="n">pdf</span> <span class="o">--</span><span class="n">detail</span>
</pre></div>
</div>
<p>Extracts all the text with <code class="docutils literal notranslate"><span class="pre">content_points</span></code> for each character. You can
use these results to produce valid parameters to <code class="docutils literal notranslate"><span class="pre">--highlight_start</span></code>
and <code class="docutils literal notranslate"><span class="pre">--highlight-end</span></code>. Example output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>extracting text for page 0:
H U+0048 : (0, 5, 0, 0, 0, false)
e U+0065 : (0, 5, 0, 1, 0, false)
l U+006c : (0, 5, 0, 2, 0, false)
l U+006c : (0, 5, 0, 3, 0, false)
o U+006f : (0, 5, 0, 4, 0, false)
 U+0020 : (0, 5, 0, 5, 0, false)
W U+0057 : (0, 5, 0, 6, 0, false)
o U+006f : (0, 5, 0, 7, 0, false)
r U+0072 : (0, 5, 0, 8, 0, false)
l U+006c : (0, 5, 0, 9, 0, false)
d U+0064 : (0, 5, 0, 10, 0, false)
! U+0021 : (0, 5, 0, 11, 0, false)
</pre></div>
</div>
<p><strong>Page Info</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">info</span> <span class="n">alice</span><span class="o">.</span><span class="n">pdf</span> <span class="o">--</span><span class="n">page</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Displays the dimensions and rotate key of the first page of alice.pdf.</p>
</div>
<div class="section" id="document-info">
<h4>Document Info<a class="headerlink" href="#document-info" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">info</span> <span class="n">alice</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
<p>Displays the page count of alice.pdf.</p>
</div>
<div class="section" id="requesting-multiple-pages">
<h4>Requesting Multiple Pages<a class="headerlink" href="#requesting-multiple-pages" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">draw</span> <span class="n">alice</span><span class="o">.</span><span class="n">pdf</span> <span class="o">--</span><span class="n">pages</span> <span class="mi">12</span> <span class="mi">23</span> <span class="mi">42</span> <span class="o">//</span> <span class="n">Draws</span> <span class="n">pages</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">23</span> <span class="ow">and</span> <span class="mi">42</span> <span class="n">of</span> <span class="n">alice</span><span class="o">.</span><span class="n">pdf</span>
<span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">text</span> <span class="n">alice</span><span class="o">.</span><span class="n">pdf</span> <span class="o">--</span><span class="n">pages</span> <span class="nb">all</span> <span class="o">//</span> <span class="n">Extracts</span> <span class="n">text</span> <span class="kn">from</span> <span class="nn">all</span> <span class="n">pages</span> <span class="n">of</span> <span class="n">alice</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
<p>You can pass multiple page numbers (or simply the word “all”) to
the <code class="docutils literal notranslate"><span class="pre">draw</span></code>, <code class="docutils literal notranslate"><span class="pre">text</span></code> and <code class="docutils literal notranslate"><span class="pre">info</span></code> verbs. Note that interaction with other
parameters, such as <code class="docutils literal notranslate"><span class="pre">--highlight-start</span></code> and <code class="docutils literal notranslate"><span class="pre">--highlight-end</span></code>, may be
surprising and undesired.</p>
</div>
<div class="section" id="accessibility-info-extraction">
<h4>Accessibility Info Extraction<a class="headerlink" href="#accessibility-info-extraction" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">accessibility</span> <span class="n">alice</span><span class="o">.</span><span class="n">pdf</span> <span class="o">--</span><span class="n">page</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Extracts all the accessibility info (like node text, bounding box, etc)
of the first page of alice.pdf and writes it to the console.</p>
</div>
</div>
<div class="section" id="tbd">
<h3>TBD<a class="headerlink" href="#tbd" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">t4-test</span></code> is missing some important features:</p>
<ul class="simple">
<li><p>A mode where test results are automatically uploaded to the server,
instead of produced locally and copied up manually after the fact.
This is needed to produce the truly enormous baselines that I’m
hoping to have one day.</p></li>
<li><p>GPU-based rendering</p></li>
<li><p>Android and Windows ports (this should be pretty easy–there’s almost
zero iOS-specific code).</p></li>
<li><p>Automatic Test update–we’d like to be able to just drop new .pdfs
into the test database and have new baselines produced as a
by-product of a run. We also want to be able to advise t4-test that a
deviation from a baseline is correct, e.g., when we fix a bug.</p></li>
<li><p>Secured PDF–t4-test needs to be able to test encrypted PDFs across
all supported security handlers. This most likely means baking
credentials into the generated test .xml files, which would have to
happen somehow during the test generation step.</p></li>
</ul>
</div>
<div class="section" id="cross-engine-comparison">
<h3>Cross engine comparison<a class="headerlink" href="#cross-engine-comparison" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://wiki.corp.adobe.com/display/t4/T4+vs+PDFium">PDFium</a></p>
<p>t4 does not support concept of optional
dependencies, for that reason, as we don’t want to bring unnecessary
dependencies in <em>develop</em> branch, pdfium support for t4-test is located
in separate  branch: <a class="reference external" href="https://git.corp.adobe.com/dcm-core-virgo/t4/tree/feature/bregeda/pdfium_t4test_review">feature/bregeda/pdfium_t4test</a>.</p>
<p>What you will need:</p>
<ul>
<li><p>git client</p></li>
<li><p>Xcode (see <a class="reference external" href="./gettingstarted.html#getting-started-ios-macos">Getting Started With
T4</a> wiki
for more details how to setup T4 environment)</p></li>
<li><p>chromuim’s depot_tools</p>
<blockquote>
<div><p><strong>quick installation guide in current terminal</strong></p>
</div></blockquote>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>DEPOT_TOOLS_PATH=&lt;directory_you_want_install_depot_tools_to&gt;
cd $DEPOT_TOOLS_PATH
$ git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git
$ export PATH=$DEPOT_TOOLS_PATH/depot_tools:$PATH
</pre></div>
</div>
<p>or refer to <a class="reference external" href="https://commondatastorage.googleapis.com/chrome-infra-docs/flat/depot_tools/docs/html/depot_tools_tutorial.html#_setting_up">depot_tools_tutorial/setting_up</a> for detailed guide</p>
</div>
<div class="section" id="building-pdfium">
<h3>Building PDFium<a class="headerlink" href="#building-pdfium" title="Permalink to this headline">¶</a></h3>
<p>First you will need to sync corresponding t4 sources:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># get t4-tools epo</span>
<span class="n">cd</span> <span class="o">&lt;</span><span class="n">your_directory_for_git_repos</span><span class="o">&gt;</span>
<span class="n">git</span> <span class="n">clone</span> <span class="o">-</span><span class="n">b</span> <span class="n">feature</span><span class="o">/</span><span class="n">bregeda</span><span class="o">/</span><span class="n">pdfium_t4test</span> <span class="n">git</span><span class="nd">@git</span><span class="o">.</span><span class="n">corp</span><span class="o">.</span><span class="n">adobe</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">dcm</span><span class="o">-</span><span class="n">core</span><span class="o">/</span><span class="n">t4</span><span class="o">-</span><span class="n">tools</span><span class="o">.</span><span class="n">git</span>

<span class="c1"># sync t4-sources</span>
<span class="n">cd</span> <span class="n">t4</span><span class="o">-</span><span class="n">tools</span><span class="o">/</span><span class="n">components</span>
<span class="o">./</span><span class="n">git</span><span class="o">-</span><span class="n">sync</span><span class="o">.</span><span class="n">py</span>

<span class="c1"># switch to t4 root directory</span>
<span class="n">cd</span> <span class="n">repos</span><span class="o">/</span><span class="n">t4</span>
</pre></div>
</div>
<p>Unfortunately google does not use any common build systems like CMake
for their projects which makes it non-trivial to incorporate pdfium
build from sources into t4 Xcode workspace. Hence the next step is to
build pdfium separately using help script t4 root directory.</p>
<p>This will sync master branch of <a class="reference external" href="https://pdfium.googlesource.com">pdfium
project</a> and build
<strong>libpdfium</strong> static library. Pdfium repo seems to be very slow for
external user, so be patient, first run can take a very long time to
sync all the sources.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># assuming you&#39;re already in t4 root directory, run</span>
<span class="o">./</span><span class="n">install_pdfium</span><span class="o">.</span><span class="n">sh</span>
<span class="c1"># . . .</span>
<span class="c1"># you should see this message at the end of script execution</span>
<span class="c1"># PDFium static library is located at: /&lt;your_t4_path&gt;/../pdfium/out/Release/obj/libpdfium.a</span>
</pre></div>
</div>
<p>If above build succeeded you should be able to see libpdfium.a binary
at:</p>
<p>&gt; ls -l ../pdfium/out/Release/obj/libpdfium.a</p>
<p>-rw-r--r-- 1 bregeda staff 199571648 Jul 30 17:15
../pdfium/out/Release/obj/libpdfium.a</p>
<p>Final step is to build t4-test.
Open <strong>projects/all/Xcode/t4_all.xcworkspace</strong> in Xcode and
build <strong>t4-test_with_pdfium.osx.Release</strong> target.</p>
</div>
<div class="section" id="executing-t4-vs-pdfium-tests">
<h3>Executing t4 vs pdfium tests<a class="headerlink" href="#executing-t4-vs-pdfium-tests" title="Permalink to this headline">¶</a></h3>
<p>I found following setup to be useful when running cross engine
comparison tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">parameters</span> <span class="n">meaning</span>
<span class="o">--</span><span class="n">zap</span>                           <span class="c1"># deletes output directory before run</span>
<span class="o">--</span><span class="n">simple</span>                        <span class="c1"># skips random and reflow tests that are not supported by thirdparty engines</span>
<span class="o">--</span><span class="n">relative</span><span class="o">-</span><span class="n">urls</span>         <span class="c1"># use relative urls instead of full paths when generates report, so results can be easily copied without breaking links</span>
</pre></div>
</div>
<ul class="simple">
<li><p>generate t4 renderings as a baseline to compare with:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">generate</span> <span class="o">&lt;</span><span class="n">input_file_or_directory</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">out</span> <span class="o">&lt;</span><span class="n">generated_baseline_directory</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">zap</span> <span class="o">--</span><span class="n">simple</span> <span class="o">--</span><span class="k">for</span><span class="o">-</span><span class="n">comparison</span> <span class="o">--</span><span class="n">verbose</span>
</pre></div>
</div>
<ul class="simple">
<li><p>execute tests to compare pdfium rendering against t4 baseline</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t4</span><span class="o">-</span><span class="n">test</span> <span class="n">execute</span> <span class="o">&lt;</span><span class="n">generated_baseline_directory</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">out</span> <span class="o">&lt;</span><span class="n">test_results_directory</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">zap</span> <span class="o">--</span><span class="n">relative</span><span class="o">-</span><span class="n">urls</span> <span class="o">--</span><span class="n">engine</span> <span class="n">pdfium</span> <span class="o">--</span><span class="n">diff</span><span class="o">-</span><span class="n">tolerance</span> <span class="mi">1</span> <span class="o">--</span><span class="n">verbose</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="t4x">
<h2>t4x<a class="headerlink" href="#t4x" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">t4x</span></code> is:</p>
<ul class="simple">
<li><p>a static library of utility functions based on t4 services.</p></li>
</ul>
<p>It is <em>not</em>:</p>
<ul class="simple">
<li><p>Intended for use in shipping applications</p></li>
<li><p>Guaranteed to provide a stable API over time</p></li>
<li><p>As rigorously code reviewed as t4</p></li>
<li><p>(Currently) available anywhere but iOS and OSX</p></li>
</ul>
<div class="section" id="rationale">
<h3>Rationale<a class="headerlink" href="#rationale" title="Permalink to this headline">¶</a></h3>
<p>As the t4 project grows in scope, a family of tools is growing along
with it: <code class="docutils literal notranslate"><span class="pre">t4_batch</span></code>, <code class="docutils literal notranslate"><span class="pre">t4_cmd</span></code>, <code class="docutils literal notranslate"><span class="pre">t4_lab</span></code>, etc. These are (usually command-line)
tools that exist solely to help debug and test t4. As you might expect,
they have a fair amount of functionality in common. A typical <code class="docutils literal notranslate"><span class="pre">t4x</span></code>
function or class started its life inside one of the utilities, and was
moved into <code class="docutils literal notranslate"><span class="pre">t4x</span></code> when it became clear that it would be useful to another
tool. <code class="docutils literal notranslate"><span class="pre">t4x::draw_page</span></code> is a good example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">namespace</span> <span class="n">t4x</span> <span class="p">{</span>

<span class="n">std</span><span class="p">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">t4</span><span class="p">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">t4</span><span class="p">::</span><span class="n">byte_graphic_store</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">t4</span><span class="p">::</span><span class="n">exception_ptr</span><span class="o">&gt;</span>
<span class="n">draw_page</span><span class="p">(</span> <span class="n">t4</span><span class="p">::</span><span class="n">pdf</span><span class="p">::</span><span class="n">document</span><span class="o">&amp;</span> <span class="n">doc</span><span class="p">,</span> <span class="n">t4</span><span class="p">::</span><span class="n">pdf</span><span class="p">::</span><span class="n">page_num</span> <span class="n">page</span><span class="p">,</span> <span class="n">t4</span><span class="p">::</span><span class="n">int_rect</span> <span class="n">const</span><span class="o">&amp;</span> <span class="n">bounds</span><span class="p">,</span>
        <span class="n">t4</span><span class="p">::</span><span class="n">affine_transform</span> <span class="n">const</span><span class="o">&amp;</span> <span class="n">page_to_device_xform</span><span class="p">,</span>
        <span class="n">t4</span><span class="p">::</span><span class="n">pdf</span><span class="p">::</span><span class="n">reflow_layout_params</span> <span class="n">const</span>\<span class="o">*</span> <span class="n">rk</span> <span class="o">=</span> <span class="n">nullptr</span> <span class="p">);</span>
<span class="p">}</span> <span class="o">//</span> <span class="n">end</span> <span class="n">namespace</span> <span class="n">t4x</span>
</pre></div>
</div>
<p>This isn’t a page-drawing routine we’d expect real-world application
clients to use. Most clients want to allocate their own buffers, specify
their own pixel formats, implement their own mark- and error-handling
callbacks, etc. But if you’re just writing a command-line utility to
test a particular rendering and don’t really want to worry about how to
set up storage for a pixel buffer, you can use <code class="docutils literal notranslate"><span class="pre">t4x::draw_page</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">t4x</span></code> also includes png-related utility functions, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">namespace</span> <span class="n">t4x</span> <span class="p">{</span>

<span class="n">void</span> <span class="n">save_to_png</span><span class="p">(</span> <span class="n">boost</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">path</span> <span class="n">const</span><span class="o">&amp;</span> <span class="n">path</span><span class="p">,</span> <span class="n">typename</span> <span class="n">t4</span><span class="p">::</span><span class="n">im</span><span class="p">::</span><span class="n">RasterSourceType</span><span class="o">&lt;</span><span class="n">t4</span><span class="p">::</span><span class="n">byte_signal_traits</span><span class="o">&gt;</span><span class="p">::</span><span class="nb">type</span> <span class="n">const</span><span class="o">&amp;</span> <span class="n">buffers</span> <span class="p">);</span>

<span class="p">}</span> <span class="o">//</span> <span class="n">end</span> <span class="n">namespace</span> <span class="n">t4x</span>
</pre></div>
</div>
<p>(<code class="docutils literal notranslate"><span class="pre">&quot;buffers&quot;</span></code> will typically be the result of a call
to <code class="docutils literal notranslate"><span class="pre">t4::byte_graphic_store::GetBuffers()</span></code>.) This function is in <code class="docutils literal notranslate"><span class="pre">t4x</span></code>
because we want it to be easy to produce .pngs from .pdfs in our command
line tools, but we don’t want to require shipping products to link
in <code class="docutils literal notranslate"><span class="pre">libpng</span></code> if they don’t want to.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Adobe Inc..
      <span class="lastupdated">
        Last update: Aug 30, 2021. 
        <img src="../_static/adobelogo.png" class="logo"/> 
      </span>

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>